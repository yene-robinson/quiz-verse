'use client';

import { useCallback } from 'react';\nimport { useStore } from '@/store';\n\nexport interface UseLoadingOptions {\n  component?: string;\n  global?: boolean;\n}\n\nexport function useLoading(options: UseLoadingOptions = {}) {\n  const { component, global = false } = options;\n  \n  const {\n    globalLoading,\n    componentLoading,\n    setGlobalLoading,\n    setComponentLoading,\n    clearComponentLoading,\n    clearAllLoading,\n  } = useStore();\n\n  const currentLoading = global \n    ? globalLoading \n    : component \n      ? componentLoading[component] || { isLoading: false }\n      : { isLoading: false };\n\n  const setLoading = useCallback(\n    (isLoading: boolean, message?: string, progress?: number) => {\n      const loadingState = { isLoading, message, progress };\n      \n      if (global) {\n        setGlobalLoading(loadingState);\n      } else if (component) {\n        setComponentLoading(component, loadingState);\n      }\n    },\n    [global, component, setGlobalLoading, setComponentLoading]\n  );\n\n  const clearLoading = useCallback(() => {\n    if (global) {\n      setGlobalLoading({ isLoading: false });\n    } else if (component) {\n      clearComponentLoading(component);\n    }\n  }, [global, component, setGlobalLoading, clearComponentLoading]);\n\n  const updateProgress = useCallback(\n    (progress: number, message?: string) => {\n      const loadingState = { \n        isLoading: true, \n        message: message || currentLoading.message, \n        progress \n      };\n      \n      if (global) {\n        setGlobalLoading(loadingState);\n      } else if (component) {\n        setComponentLoading(component, loadingState);\n      }\n    },\n    [global, component, currentLoading.message, setGlobalLoading, setComponentLoading]\n  );\n\n  const updateMessage = useCallback(\n    (message: string) => {\n      const loadingState = { \n        isLoading: true, \n        message, \n        progress: currentLoading.progress \n      };\n      \n      if (global) {\n        setGlobalLoading(loadingState);\n      } else if (component) {\n        setComponentLoading(component, loadingState);\n      }\n    },\n    [global, component, currentLoading.progress, setGlobalLoading, setComponentLoading]\n  );\n\n  return {\n    isLoading: currentLoading.isLoading,\n    message: currentLoading.message,\n    progress: currentLoading.progress,\n    setLoading,\n    clearLoading,\n    updateProgress,\n    updateMessage,\n    clearAllLoading,\n  };\n}